After making changesâ€¦

1) Pandoc all index.md files, except the one in the top directory, to index.html. We disable Markdown auto identifiers, add the meta description and CSS to the head, and add the header and footer.

find . -name "index.md" ! -path "./index.md" -execdir pandoc index.md -o index.html -f markdown-auto_identifiers -H desc.txt -H ../styles.txt -B ../header.txt -A ../footer.txt \;

2) Pandoc index.md in the top directory to index.html. The difference here is that we omit the header and footer, and the paths change for the description and CSS.

pandoc index.md -o index.html -f markdown-auto_identifiers -H desc.txt -H styles.txt

3) In the generated HTML files, add target="_blank" and rel="noopener" to all links to external sites.

find . -name "index.html" -exec sed -i '' 's/a href="http/a target="_blank" rel="noopener" href="http/g' {} \;

4) Minify all HTML. (For some reason, this prevents errors in the subsequent encoding step.)

find . -name "*.html" -exec html-minifier {} -o {} --collapse-whitespace --minify-css true \;

5) Encode special characters as HTML entities in the generated files.

for i in `find . -name "index.html"`; do he --encode --allow-unsafe < $i > $i.out; done
find . -name "index.html.out" -execdir mv index.html.out index.html \;

6) For good measure, minify all HTML again, then run it through Prettier.

find . -name "*.html" -exec html-minifier {} -o {} --collapse-whitespace --minify-css true \;
find . -name "*.html" -exec prettier {} --write \;

As a sequence of commands:

find . -name "index.md" ! -path "./index.md" -execdir pandoc index.md -o index.html -f markdown-auto_identifiers -H desc.txt -H ../styles.txt -B ../header.txt -A ../footer.txt \; && pandoc index.md -o index.html -f markdown-auto_identifiers -H desc.txt -H styles.txt && find . -name "index.html" -exec sed -i '' 's/a href="http/a target="_blank" rel="noopener" href="http/g' {} \; && find . -name "*.html" -exec html-minifier {} -o {} --collapse-whitespace --minify-css true \; && for i in `find . -name "index.html"`; do he --encode --allow-unsafe < $i > $i.out; done && find . -name "index.html.out" -execdir mv index.html.out index.html \; && find . -name "*.html" -exec html-minifier {} -o {} --collapse-whitespace --minify-css true \; && find . -name "*.html" -exec prettier {} --write \;


Caveat(s):
- Double-check the formatting of footnote 41 in "Black Particularity Reconsidered." Pandoc has a certain Markdown syntax for multi-paragraph footnotes, which seems not to be recognized by auto-formatters.
