After making changesâ€¦

1) Pandoc all index.md files, except the one in the top directory, to index.html. We disable Markdown auto identifiers, specify two spaces per tab, add the meta description and CSS link to the head, then the header and footer, and finally the link to the theme selector script.

find . -name "index.md" ! -path "./index.md" -execdir pandoc index.md -o index.html -f markdown-auto_identifiers --tab-stop=2 -H desc.html -H ../components/style-links.html -B ../components/header.html -A ../components/footer.html -A ../components/script-link.html \;

2) Pandoc index.md in the top directory to index.html. The difference here is that we have a slightly different header and omit the footer, and the paths change for the description and the CSS and JS links.

pandoc index.md -o index.html -f markdown-auto_identifiers --tab-stop=2 -H desc.html -H components/style-links-main.html -B components/header-main.html -A components/script-link-main.html

3) In the generated HTML files, add target="_blank" and rel="noopener" to all links to external sites.

find . -name "index.html" -exec sed -i '' 's/a href="http/a target="_blank" rel="noopener" href="http/g' {} \;

4) Minify all HTML. (For some reason, this prevents errors in the subsequent encoding step.)

find . -name "*.html" -exec html-minifier --collapse-whitespace --minify-css true -o {} {} \;

5) Encode special characters as HTML entities in the generated files.

for i in `find . -name "index.html"`; do he --encode --allow-unsafe < $i > $i.out; done
find . -name "index.html.out" -execdir mv index.html.out index.html \;

6) For good measure, minify all HTML again, then run it through Prettier.

find . -name "*.html" -exec html-minifier --collapse-whitespace --minify-css true -o {} {} \;
find . -name "*.html" -exec prettier --write {} \;

As a sequence of commands:

find . -name "index.md" ! -path "./index.md" -execdir pandoc index.md -o index.html -f markdown-auto_identifiers --tab-stop=2 -H desc.html -H ../components/style-links.html -B ../components/header.html -A ../components/footer.html -A ../components/script-link.html \; && pandoc index.md -o index.html -f markdown-auto_identifiers --tab-stop=2 -H desc.html -H components/style-links-main.html -B components/header-main.html -A components/script-link-main.html && find . -name "index.html" -exec sed -i '' 's/a href="http/a target="_blank" rel="noopener" href="http/g' {} \; && find . -name "*.html" -exec html-minifier --collapse-whitespace --minify-css true -o {} {} \; && for i in `find . -name "index.html"`; do he --encode --allow-unsafe < $i > $i.out; done && find . -name "index.html.out" -execdir mv index.html.out index.html \; && find . -name "*.html" -exec html-minifier --collapse-whitespace --minify-css true -o {} {} \; && find . -name "*.html" -exec prettier --write {} \;
